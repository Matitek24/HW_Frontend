<template>
    <div class="svg-wrapper position-relative" style="padding-top:130px;">
      
      <div v-if="showPompon" class="pompon" style="position:absolute;  z-index:2; top:65px; transform: scale(3)">
        <HatPompon :config="config" />
      </div>
  
      <svg 
        style="transform: rotate(-0.4deg);transform-origin: center;"
        id="Warstwa_1_Obrazek_2" 
        ref="svgRef"
        data-name="Warstwa 1" 
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink" 
        viewBox="15 0 565.42 552.52"
      >
     <defs>

      <clipPath id="clippath3">
                <path class="cls-2-2"
                d="M578.22,462.86c-.37-11.3-.81-22.67-1.57-34.09-1.14-17.07-.15,11.68.34-5.86.23-8.27.35-16.57.59-24.92.14-4.83-1.1-9.32-2.37-13.91-1.44-5.2-1.44-6.03-4.57-11.18-.62-1.03-8.44-.2-8.66-.18-.78-6.49-1.75-12.46-1.89-14.59,1.43-11.45-19.64-191.64-19.64-191.64,0,0-.39-1.07-1.01-2.77-.31-.85-.68-1.87-1.08-2.99-.2-.56-.42-1.15-.64-1.75-.22-.61-.45-1.23-.68-1.87-.23-.64-.47-1.29-.71-1.95-.24-.66-.48-1.33-.72-1.99-.24-.67-.48-1.33-.72-1.99-.24-.66-.48-1.31-.71-1.95-.23-.64-.46-1.27-.68-1.88-.22-.61-.43-1.2-.64-1.76-.41-1.12-.78-2.14-1.09-3-.62-1.72-1.01-2.79-1.01-2.79h0c-.24-1.05-.46-1.96-.83-2.81-.39-.91-.78-1.82-1.17-2.73-.39-.91-.78-1.82-1.18-2.73-.39-.91-.79-1.82-1.18-2.73-.4-.91-.79-1.82-1.19-2.74-.4-.91-.8-1.83-1.19-2.74-.4-.92-.8-1.83-1.19-2.75-.4-.92-.8-1.84-1.19-2.76-.4-.92-.79-1.84-1.19-2.76-.37-.86-.74-1.73-1.11-2.59-.37-.87-.73-1.73-1.1-2.6-.37-.87-.73-1.73-1.09-2.6-.36-.87-.73-1.73-1.09-2.6-.36-.87-.73-1.73-1.09-2.6-.36-.87-.73-1.73-1.09-2.6-.3-.51-.59-1.02-.89-1.53-.3-.51-.6-1.01-.91-1.51-.61-1-1.23-2-1.86-2.98-.63-.98-1.27-1.96-1.91-2.92-18.82-28.02-45.53-47.88-76.4-60.99-8.53-3.62-17.37-6.74-26.41-9.46C312.48-7.84,199.97-6.18,121.16,51.74c-14.2,12.21-25.98,25.99-35.8,40.71-1.23,1.84-2.42,3.69-3.59,5.55-1.16,1.86-2.3,3.74-3.41,5.63-1.11,1.89-2.18,3.79-3.23,5.7-1.05,1.91-2.07,3.83-3.06,5.77-.99,1.93-1.96,3.87-2.9,5.82-.94,1.95-1.85,3.91-2.74,5.87-.32.7-.61,1.42-.88,2.15-.27.73-.52,1.47-.76,2.22-.4.56-.75,1.14-1.06,1.74-.31.6-.57,1.21-.79,1.85-4.83,14.23-7.73,24.2-9.49,31.08,0,0-10.69,176.46-13.24,195.4,0,6.63-1.51,4.11-2.76,9.48-1.85.04-3.69.06-5.55,0-6.77-.22-10.27,12.93-11.88,18.84-1.25,4.59-2.09,9.16-1.74,13.98.61,8.33,1.11,16.62,1.71,24.88,1.28,17.5,1.66,2.7,1.3,19.8-.24,11.43,1.19,8.8,1.34,20.09.14,10.62.33,21.18.93,31.67.33,5.91,2.26,11.58,7.63,16.03,6.52,4.83,13.69,8.74,20.89,12.61,7.03,3.77,14.68,5.98,22.19,8.58,14.46,5.02,29.36,6.79,44.39,7.99,13.01,1.04,26.02,2.11,39.01,3.21,7.74.66,15.46,1.47,23.19,2.1,7.64.63,15.24.34,22.75-.76,2.26-.33,4.42-1.15,7.31-1.92,8.25,3,17.75,3.12,27.16,3.37,2.78.07,5.81-.57,8.33-1.6,3.23-1.32,6.08-.77,9.09.16,1.12.34,2.16.91,3.29,1.16,2.78.62,5.61,1.61,8.39,1.57,7.97-.12,16.02.05,23.61-2.79,3.42-1.28,6.96-.27,10.46.27,8.22,1.26,16.55,1.6,24.51-.76,4.11-1.22,7.75-1.34,12.01-.98,7.27.62,14.7.35,22.03-.05,3.16-.17,6.24-1.63,9.39-2.42.94-.24,2.03-.47,2.92-.28,7.49,1.63,15.01,2.97,22.78,3.41,4.72.27,8.46-.13,12.69-2.27,8.22,3.91,17.46,3.48,26.64,3.26,1.03-.02,2.18-.14,3.09-.55.86-.39,1.73-.7,2.61-.96,2.17-.28,4.34-.55,6.51-.81.89-.11,1.78-.21,2.67-.32,1.62-.02,3.25,0,4.87,0,.09-.2.18-.4.26-.6,10.36-1.23,20.74-2.44,31.12-3.63,15.01-1.72,29.86-4,44.14-9.51,7.42-2.86,15-5.33,21.87-9.34,7.05-4.11,14.07-8.27,20.4-13.32,5.19-4.63,6.87-10.37,6.94-16.29.12-10.51-.16-21.07-.5-31.69Z" />
      </clipPath>
     </defs>

        <!-- <clipPath id="maska-srodek">
          <path d="M949.65,276.98c-419.64,77.74-849.69,83.84-1271.39,18.27,9.1-62.56,18.27-125.1,27.52-187.64,400.34,63.69,808.73,59.36,1207.59-13,12.02,60.8,24.11,121.59,36.28,182.37Z" />
        </clipPath> -->

        <!-- <clipPath id="dolnamaskaprawa" transform="translate(0, -400)">
          <path class="cls-2-2"
            d="M594.86,462.47c-.39-11.35-.86-22.77-1.67-34.24-1.21-17.15-.16-34.61.36-52.22.25-8.31.38-16.65.63-25.04.15-4.85-.66-9.52-2.52-13.98-2.18-5.2-5.86-8.54-13.07-8.07-.24.02-.47.02-.71.03-.83-6.52-2.13-13.06-2.27-15.2,1.52-11.51-20.86-149.01-20.86-149.01,0,0-.41-1.07-1.07-2.79-.33-.86-.72-1.87-1.15-3-.22-.56-.44-1.15-.68-1.76-.23-.61-.48-1.24-.72-1.88-.25-.64-.5-1.3-.75-1.96-.25-.66-.51-1.33-.77-2-.26-.67-.51-1.34-.77-2-.25-.66-.51-1.32-.75-1.96-.25-.64-.49-1.27-.72-1.88-.23-.61-.46-1.2-.68-1.77-.43-1.13-.82-2.15-1.15-3.01-.66-1.72-1.07-2.8-1.07-2.8h0c-.26-1.05-.49-1.97-.88-2.83-.41-.91-.82-1.83-1.24-2.74-.42-.91-.83-1.83-1.25-2.74-.42-.91-.84-1.83-1.26-2.75-.42-.92-.84-1.83-1.26-2.75-.42-.92-.84-1.84-1.27-2.76-.42-.92-.85-1.84-1.27-2.76-.42-.92-.84-1.84-1.27-2.77-.42-.92-.84-1.85-1.26-2.77-.39-.87-.78-1.74-1.17-2.6-.39-.87-.78-1.74-1.17-2.61-.39-.87-.78-1.74-1.16-2.61-.39-.87-.77-1.74-1.16-2.61-.39-.87-.77-1.74-1.16-2.61-.39-.87-.77-1.74-1.16-2.61-.31-.51-.63-1.03-.95-1.53-.32-.51-.64-1.02-.96-1.52-.65-1.01-1.3-2.01-1.97-2.99-.67-.99-1.35-1.97-2.03-2.93-20-28.15-48.36-48.09-81.15-61.27-9.06-3.64-18.45-6.77-28.05-9.51C312.59-10.36,193.08-8.69,109.37,49.49c-15.08,12.26-27.59,26.11-38.02,40.9-1.3,1.85-2.57,3.71-3.81,5.58-1.24,1.87-2.44,3.76-3.62,5.66-1.17,1.9-2.32,3.81-3.43,5.73-1.11,1.92-2.2,3.85-3.25,5.79-1.06,1.94-2.08,3.89-3.08,5.85-1,1.96-1.97,3.92-2.91,5.9-.34.71-.65,1.43-.93,2.16-.29.73-.55,1.47-.81,2.23-.42.57-.8,1.15-1.12,1.75-.33.6-.61,1.22-.84,1.86-5.13,14.29-8.21,24.31-10.08,31.22,0,0-11.35,130.92-14.06,149.95,0,6.66-1.6,14.53-2.94,19.92-1.96.04-3.92.06-5.89,0-7.19-.22-10.7,3.25-12.62,8.52-1.64,4.51-2.22,9.2-1.84,14.05.65,8.37,1.18,16.7,1.82,24.99,1.36,17.58,3.22,34.98,2.84,52.15-.26,11.48-.19,22.91-.04,34.26.14,10.67.35,21.27.99,31.82.36,5.93,2.4,11.63,8.11,16.1,6.93,4.86,14.55,8.78,22.19,12.66,7.46,3.79,15.59,6,23.57,8.62,15.36,5.04,31.18,6.82,47.15,8.03,13.82,1.05,27.64,2.12,41.44,3.23,8.22.66,16.42,1.48,24.63,2.11,8.12.63,16.19.34,24.16-.77,2.4-.33,4.7-1.15,7.77-1.93,8.77,3.02,18.85,3.14,28.85,3.39,2.96.07,6.17-.57,8.85-1.61,3.43-1.33,6.46-.77,9.66.16,1.19.35,2.29.92,3.5,1.17,2.95.62,5.96,1.62,8.91,1.58,8.46-.13,17.01.05,25.08-2.8,3.63-1.28,7.39-.27,11.11.27,8.73,1.27,17.58,1.61,26.04-.77,4.37-1.22,8.23-1.35,12.75-.98,7.72.62,15.61.35,23.41-.05,3.36-.17,6.63-1.63,9.97-2.43.99-.24,2.16-.48,3.1-.28,7.96,1.64,15.95,2.98,24.19,3.42,5.02.27,8.98-.14,13.48-2.28,8.73,3.93,18.54,3.5,28.3,3.28,1.10-.02,2.32-.14,3.28-.55.91-.39,1.84-.71,2.77-.97,2.3-.28,4.61-.55,6.91-.81.94-.11,1.89-.21,2.83-.32,1.72-.02,3.45,0,5.17,0,.10-.20.19-.40.28-.61,11.01-1.23,22.03-2.45,33.06-3.64,15.94-1.73,31.72-4.02,46.88-9.56,7.88-2.88,15.93-5.35,23.23-9.38,7.48-4.13,14.95-8.3,21.66-13.38,5.51-4.65,7.3-10.42,7.37-16.36.13-10.56-.17-21.17-.53-31.84Z" /> 
        </clipPath> -->
        
          
        <g class="cls-4-2">
          <g>
            <g>
              <path class="cls-base" :fill="config.base.top" d="M845.53,165.1c-353.01,61.25-713.92,61.31-1066.94.17,12.22-70.55,24.44-141.11,36.66-211.66,328.74,56.93,664.83,56.88,993.56-.16,12.24,70.55,24.48,141.1,36.72,211.65Z"/>
              <path class="cls-base" :fill="config.base.middle" d="M874.91,334.43c-372.43,64.62-753.2,64.68-1125.65.18,9.77-56.44,19.55-112.89,29.32-169.33,353.02,61.14,713.94,61.08,1066.94-.17,9.79,56.44,19.59,112.88,29.38,169.32Z"/>
              <path class="cls-base" :fill="config.base.bottom" d="M904.29,503.75c-391.85,67.99-792.48,68.06-1184.35.19,9.77-56.44,19.55-112.89,29.32-169.33,372.45,64.5,753.22,64.44,1125.65-.18,9.79,56.44,19.59,112.88,29.38,169.32Z"/>
            </g>
            
            <g class="pasek">
             <path d="M-226.61,511.04c-.94-.15-1.88-.3-2.82-.45,8.97-56.35,17.94-112.7,26.9-169.05.89.14,1.79.28,2.68.43-8.92,56.36-17.84,112.72-26.76,169.07Z"/>
             <path d="M-254.82,506.45c-.94-.16-1.88-.31-2.82-.47,9.44-56.27,18.87-112.55,28.31-168.82.89.15,1.79.3,2.68.45-9.39,56.28-18.78,112.56-28.17,168.85Z"/>
             <path d="M-197.23,515.56c-.94-.14-1.88-.28-2.83-.42,8.48-56.43,16.96-112.85,25.44-169.28.89.13,1.79.27,2.68.4-8.43,56.43-16.87,112.87-25.3,169.3Z"/>
             <path d="M-167.83,519.82c-.94-.13-1.89-.27-2.83-.4,7.99-56.5,15.99-112.99,23.98-169.49.9.13,1.79.25,2.69.38-7.95,56.5-15.89,113.01-23.84,169.51Z"/>
             <path d="M-138.41,523.83c-.94-.12-1.89-.25-2.83-.37,7.5-56.56,15.01-113.13,22.51-169.69.9.12,1.79.24,2.69.36-7.46,56.57-14.92,113.14-22.37,169.71Z"/>
             <path d="M-108.95,527.59c-.94-.12-1.89-.23-2.83-.35,7.02-56.63,14.03-113.25,21.05-169.88.9.11,1.79.22,2.69.33-6.97,56.63-13.94,113.26-20.91,169.9Z"/>
             <path d="M-79.48,531.08c-.95-.11-1.89-.22-2.84-.33,6.53-56.69,13.06-113.37,19.58-170.06.9.1,1.8.21,2.69.31-6.48,56.69-12.96,113.38-19.44,170.07Z"/>
             <path d="M-46.95,534.65c-.95-.1-1.89-.2-2.84-.3,5.99-56.74,11.98-113.49,17.96-170.23.9.09,1.8.19,2.7.28-5.94,56.75-11.88,113.5-17.82,170.25Z"/>
             <path d="M-17.43,537.61c-.95-.09-1.89-.18-2.84-.27,5.5-56.79,11-113.59,16.5-170.38.9.09,1.8.17,2.7.26-5.45,56.8-10.9,113.6-16.35,170.4Z"/>
             <path d="M12.11,540.31c-.95-.08-1.89-.17-2.84-.25,5.01-56.84,10.02-113.68,15.03-170.52.9.08,1.8.16,2.7.24-4.96,56.84-9.92,113.69-14.88,170.53Z"/>
             <path d="M41.66,542.77c-.95-.07-1.9-.15-2.84-.22,4.52-56.88,9.04-113.76,13.56-170.64.9.07,1.8.14,2.7.21-4.47,56.88-8.94,113.77-13.41,170.65Z"/>
             <path d="M71.23,544.96c-.95-.07-1.9-.13-2.84-.2,4.03-56.92,8.06-113.83,12.08-170.75.9.06,1.8.13,2.7.19-3.98,56.92-7.96,113.84-11.94,170.76Z"/>
             <path d="M100.82,546.9c-.95-.06-1.9-.12-2.85-.18,3.54-56.95,7.07-113.9,10.61-170.85.9.06,1.8.11,2.7.17-3.49,56.95-6.98,113.91-10.47,170.86Z"/>
             <path d="M130.03,548.57c-.95-.05-1.9-.1-2.85-.15,3.05-56.98,6.11-113.96,9.16-170.93.9.05,1.8.1,2.7.14-3.01,56.98-6.01,113.96-9.02,170.94Z"/>
             <path d="M159.64,550c-.95-.04-1.9-.08-2.85-.13,2.56-57,5.12-114,7.69-171.01.9.04,1.8.08,2.71.12-2.51,57-5.03,114.01-7.54,171.01Z"/>
             <path d="M189.25,551.18c-.95-.03-1.9-.07-2.85-.1,2.07-57.02,4.14-114.04,6.21-171.07.9.03,1.8.07,2.71.1-2.02,57.02-4.05,114.05-6.07,171.07Z"/>
             <path d="M218.87,552.1c-.95-.03-1.9-.05-2.85-.08,1.58-57.04,3.16-114.08,4.74-171.11.9.02,1.8.05,2.71.07-1.53,57.04-3.06,114.08-4.6,171.12Z"/>
             <path d="M248.5,552.77c-.95-.02-1.9-.04-2.85-.05,1.09-57.05,2.18-114.1,3.26-171.15.9.02,1.8.03,2.71.05-1.04,57.05-2.08,114.1-3.12,171.15Z"/>
             <path d="M278.13,553.19c-.95,0-1.9-.02-2.85-.03.6-57.06,1.19-114.11,1.79-171.17.9,0,1.8.02,2.71.03-.55,57.06-1.1,114.11-1.65,171.17Z"/>
             <path d="M310.8,553.34c-.95,0-1.9,0-2.85,0,.05-57.06.11-114.12.16-171.18.9,0,1.8,0,2.71,0,0,57.06-.02,114.12-.02,171.18Z"/>
             <path d="M340.43,553.22c-.95,0-1.9.02-2.85.02-.44-57.06-.87-114.12-1.31-171.17.9,0,1.8-.01,2.71-.02.48,57.06.97,114.12,1.45,171.17Z"/>
             <path d="M370.06,552.84c-.95.02-1.9.03-2.85.05-.93-57.05-1.86-114.1-2.78-171.16.9-.01,1.8-.03,2.71-.05.98,57.05,1.95,114.1,2.93,171.15Z"/>
             <path d="M399.69,552.21c-.95.02-1.9.05-2.85.07-1.42-57.04-2.84-114.08-4.26-171.13.9-.02,1.8-.05,2.71-.07,1.47,57.04,2.93,114.08,4.4,171.12Z"/>
             <path d="M429.31,551.32c-.95.03-1.9.06-2.85.1-1.91-57.03-3.82-114.06-5.73-171.08.9-.03,1.8-.06,2.71-.09,1.96,57.03,3.92,114.05,5.87,171.08Z"/>
             <path d="M458.92,550.17c-.95.04-1.9.08-2.85.12-2.4-57.01-4.8-114.02-7.21-171.03.9-.04,1.8-.08,2.71-.12,2.45,57.01,4.9,114.01,7.35,171.02Z"/>
             <path d="M489.86,548.71c-.95.05-1.9.1-2.85.15-2.92-56.99-5.83-113.97-8.75-170.96.9-.05,1.8-.09,2.7-.14,2.96,56.98,5.92,113.97,8.89,170.95Z"/>
             <path d="M519.46,547.04c-.95.06-1.9.11-2.85.17-3.41-56.96-6.81-113.92-10.22-170.87.9-.05,1.8-.11,2.7-.16,3.45,56.96,6.91,113.91,10.36,170.87Z"/>
             <path d="M549.04,545.12c-.95.07-1.9.13-2.84.2-3.9-56.93-7.79-113.85-11.69-170.78.9-.06,1.8-.12,2.7-.19,3.94,56.92,7.89,113.85,11.83,170.77Z"/>
             <path d="M578.61,542.94c-.95.07-1.9.15-2.84.22-4.39-56.89-8.77-113.78-13.16-170.67.9-.07,1.8-.14,2.7-.21,4.43,56.89,8.87,113.77,13.3,170.66Z"/>
             <path d="M608.17,540.51c-.95.08-1.89.16-2.84.24-4.88-56.85-9.75-113.7-14.63-170.55.9-.08,1.8-.15,2.7-.23,4.92,56.85,9.85,113.69,14.77,170.54Z"/>
             <path d="M637.71,537.82c-.95.09-1.89.18-2.84.27-5.37-56.81-10.73-113.61-16.1-170.42.9-.08,1.8-.17,2.7-.26,5.41,56.8,10.83,113.6,16.24,170.41Z"/>
             <path d="M670.26,534.56c-.95.1-1.89.2-2.84.3-5.91-56.75-11.81-113.51-17.72-170.26.9-.09,1.8-.19,2.7-.28,5.95,56.75,11.91,113.5,17.86,170.24Z"/>
             <path d="M699.76,531.34c-.95.11-1.89.21-2.84.32-6.4-56.7-12.79-113.4-19.19-170.1.9-.1,1.8-.2,2.69-.31,6.44,56.69,12.89,113.39,19.33,170.08Z"/>
             <path d="M729.24,527.86c-.94.12-1.89.23-2.83.35-6.89-56.64-13.77-113.29-20.66-169.93.9-.11,1.79-.22,2.69-.33,6.93,56.64,13.87,113.27,20.8,169.91Z"/>
             <path d="M758.69,524.12c-.94.12-1.89.25-2.83.37-7.37-56.58-14.75-113.16-22.12-169.74.9-.12,1.79-.23,2.69-.35,7.42,56.58,14.84,113.15,22.26,169.73Z"/>
             <path d="M788.12,520.13c-.94.13-1.89.26-2.83.39-7.86-56.52-15.72-113.03-23.59-169.55.9-.12,1.79-.25,2.69-.38,7.91,56.51,15.82,113.02,23.73,169.53Z"/>
             <path d="M817.52,515.89c-.94.14-1.88.28-2.83.42-8.35-56.45-16.7-112.89-25.05-169.34.9-.13,1.79-.27,2.69-.4,8.4,56.44,16.79,112.88,25.19,169.32Z"/>
             <path d="M848.03,511.21c-.94.15-1.88.3-2.82.44-8.86-56.37-17.71-112.74-26.57-169.1.89-.14,1.79-.28,2.68-.42,8.9,56.36,17.81,112.72,26.71,169.08Z"/>
             <path d="M879.06,506.16c-.94.16-1.88.31-2.82.47-9.37-56.28-18.74-112.57-28.11-168.85.89-.15,1.79-.3,2.68-.45,9.42,56.28,18.84,112.55,28.25,168.83Z"/>
        </g>
          </g>
        </g>
  
        <defs>
          <path id="curvePath" d="M -55 263 Q 297 300 650 263" />
        </defs>
        
        <!-- Wzór górny -->
        <g :fill="config.pattern.top">
          <g class="fls-4">
            <g transform="translate(-160, 50) scale(1.40)" id="target-wzor">
              <g v-html="topPatternSvg"></g> 
            </g>
          </g>
        </g>
        
        <!-- Główny wzór -->
        <g clip-path="url(#clippath3)" :fill="config.pattern.main">
          <g transform="translate(0, 210) scale(1.52)" id="target-graphic">
            <g v-html="mainPatternSvg"></g>
          </g>
        </g>
  
        <!-- Tekst na krzywej -->
         <g clip-path="url(#maska-srodek)">
        <g clip-path="url(#clippath3)">
          <text 
            :dy="finalTextProps.dy"
            :font-family="config.text.font" 
            font-weight="bold" 
            :font-size="finalTextProps.fontSize" 
            :fill="config.text.color"
            text-anchor="middle" 
            letter-spacing="2"
          >
            <textPath 
              xlink:href="#curvePath" 
              startOffset="50%" 
              method="align" 
              spacing="auto"
            >
              {{ config.text.content }}
            </textPath>
          </text>
        </g>
        </g>
      </svg>
    </div>
  </template>
<script setup>
import { ref, computed, watch, nextTick } from 'vue';
import { bendIt, resetWarp } from '../../utils/warpTransform.js';
import HatPompon from './HatPompon.vue';

const props = defineProps({
  config: {
    type: Object,
    required: true
  },
  showPompon: {
    type: Boolean,
    default: true
  },
  patternsDict: {
    type: Array,
    default: () => []
  }
  
});

const svgRef = ref(null);

const topPatternSvg = computed(() => {
  const selectedId = props.config.patterns.top;
  if (!selectedId || selectedId === 'none') return '';
  const pattern = props.patternsDict.find(p => p.id === selectedId);
  return pattern ? pattern.kodSvg : '';
});

const mainPatternSvg = computed(() => {
  const selectedId = props.config.patterns.bottom;
  if (!selectedId || selectedId === 'none') return '';
  const pattern = props.patternsDict.find(p => p.id === selectedId);
  return pattern ? pattern.kodSvg : '';
});

// HatFront.vue / HatThumbnail.vue
const FLAT_HEIGHT = 79.5;
const HAT_3D_HEIGHT = 114.74;

const SCALE_FACTOR = FLAT_HEIGHT / HAT_3D_HEIGHT; 

const CENTER_FROM_BOTTOM = 18; 

const finalTextProps = computed(() => {
  const userFontSize = props.config.text.fontSize || 40;
  const userOffset = -props.config.text.offsetY || 0;


  const finalFontSize = userFontSize * SCALE_FACTOR * 1.03;
  const scaledUserOffset = userOffset * SCALE_FACTOR;
  const fontCenteringCorrection = finalFontSize * 0.35;

  return {
    fontSize: finalFontSize,
    dy: CENTER_FROM_BOTTOM + scaledUserOffset + fontCenteringCorrection
  };
});
// Funkcja dla górnego wzoru
const applyTopWarp = async () => {
  await nextTick();
  setTimeout(() => {
    if (svgRef.value) {
      resetWarp('#target-wzor');
      bendIt(svgRef.value, '#target-wzor', 330, -0.0002);
    }
  }, 100);
};

// Funkcja dla dolnego wzoru
const applyBottomWarp = async () => {
  await nextTick();
  setTimeout(() => {
    if (svgRef.value) {
      resetWarp('#target-graphic');
      bendIt(svgRef.value, '#target-graphic', 205, -0.00024);
    }
  }, 100);
};

watch(
  () => topPatternSvg.value,
  (newValue) => {
    if (newValue) {
      applyTopWarp();
    }
  },
  { immediate: true }
);

// ⭐ Osobny watch dla dolnego wzoru
watch(
  () => mainPatternSvg.value,
  (newValue) => {
    if (newValue) {
      applyBottomWarp();
    }
  },
  { immediate: true }
);
</script>
  
  <style scoped>
  .dolnamaska {
    clip-path: url(#dolnamaskaprawa);
  }
  
  .fls-4 {
    clip-path: url(#clippath3);  
  }
  
  .pasek {
    fill: var(--kolor-pasek);
  }
  
  .cls-2-2 {
    fill: none;
  }
  
  .cls-4-2 {
    clip-path: url(#clippath3);
  }
  .svg-wrapper svg {
  shape-rendering: crispEdges; 
}
  </style>
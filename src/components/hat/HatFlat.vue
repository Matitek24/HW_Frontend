<template>
  <div class="svg-wrapper d-flex align-items-end">
    <svg 
      id="Warstwa_1" 
      data-name="Warstwa 1" 
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      viewBox="0 0 1144.47 714.48">
    >
      <defs>
        <clipPath id="clippath2">

          <path class="cls-2"
          d="M1144.45,189.53c-.95-5.3-30.61-167.61-95.19-167.61s-93.4,155.8-95.5,167.09c-2.07-11.29-31.82-167.09-95.1-167.09s-94.3,160.57-95.57,167.51c-1.25-6.94-30.94-167.51-95.17-167.51s-93.66,157.18-95.52,167.24c-1.84-10.06-31.57-167.24-95.12-167.24s-94.63,162.31-95.59,167.61h-.04c-.95-5.3-30.61-167.61-95.19-167.61s-94.63,162.31-95.59,167.61h-.05c-.95-5.3-30.61-167.61-95.19-167.61S.99,184.23.02,189.53h-.02v477.44h1144.47V189.53h-.02Z" />
        </clipPath>
        <clipPath id="prostokat" transform="translate(0, -360)">
          <path d="M1144.45,171.3c-.95-4.95-30.61-156.45-95.19-156.45s-93.4,145.43-95.5,155.97c-2.07-10.54-31.82-155.97-95.1-155.97s-94.3,149.88-95.57,156.36c-1.25-6.48-30.94-156.36-95.17-156.36s-93.66,146.72-95.52,156.11c-1.84-9.39-31.57-156.11-95.12-156.11s-94.63,151.5-95.59,156.45h-.04c-.95-4.95-30.61-156.45-95.19-156.45s-94.63,151.5-95.59,156.45h-.05c-.95-4.95-30.61-156.45-95.19-156.45S.99,166.35.02,171.3h-.02v445.65h1144.47V171.3h-.02Z" />
        </clipPath>
      </defs>
     
      <g class="cls-4">
        <rect :fill="config.base.bottom" class="cls-5" x="1.66" y="482.59" width="1142.81" height="231.89" />
        <rect :fill="config.base.top" class="cls-3"x="1.85" width="1142.81" height="307.04" />
        <rect :fill="config.base.middle" class="cls-1" x="1.66" y="256.81" width="1142.81" height="225.78" />
        <rect class="cls-2" x="1.66" y="6.01" width="1142.81" height="544.33" />
        
    
    <g>
      <g>
        <rect class="pasek" x="50.54" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="23.07" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="79.12" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="107.7" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="136.27" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="164.85" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="193.42" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="224.93" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="253.51" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="282.08" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="310.66" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="339.24" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="367.81" y="482.59" width="2.75" height="231.26"/>
      </g>
      <g>
        <rect class="pasek" x="396.02" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="424.6" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="453.17" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="481.75" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="510.33" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="538.9" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="570.41" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="598.99" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="627.56" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="656.14" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="684.71" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="713.29" y="482.59" width="2.75" height="231.26"/>
      </g>
      <g>
        <rect class="pasek" x="743.15" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="771.72" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="800.3" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="828.88" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="857.45" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="886.03" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="917.54" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="946.11" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="974.69" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="1003.26" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="1031.84" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="1060.42" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="1090.09" y="482.59" width="2.75" height="231.26"/>
        <rect class="pasek" x="1120.32" y="482.59" width="2.75" height="231.26"/>
      </g>
    </g>
      </g>
    
      <!-- Wzór górny -->
      <g class="prostokat">
        <g class="fls-2" :fill="config.pattern.top">
          <g v-html="topPatternSvg" transform="translate(0, 80)"></g>
        </g>
      </g>

      <!-- Główny wzór -->
      <g clip-path="url(#clippath2)">
        <g :fill="config.pattern.main" transform="translate(-10, 257) scale(1.04, 1.05)">
          <g v-html="mainPatternSvg"></g>
        </g>
      </g>

      <!-- Tekst -->
      <text 
        :x="572.23" 
        :y="370.69" 
        :fill="config.text.color" 
        :font-family="config.text.font" 
        :font-size="config.text.fontSize" 
        font-weight="bold"
        text-anchor="middle" 
        dominant-baseline="central"
      >
        {{ config.text.content }}
      </text>
    </svg>
  </div>
</template>

<script setup>
import { computed } from 'vue';
import { PATTERN_LIBRARY } from '../../utils/patterns.js';

const props = defineProps({
  config: {
    type: Object,
    required: true
  },
  patternsDict: {
    type: Array,
    default: () => []
  }
});

const topPatternSvg = computed(() => {
  const selectedId = props.config.patterns.top;
  
  if (!selectedId || selectedId === 'none') return null;

  // 2. Szukamy tego ID w słowniku z bazy
  const patternObj = props.patternsDict.find(p => p.id === selectedId);
  
  // 3. Zwracamy kod SVG (string) lub null
  return patternObj ? patternObj.kodSvg : null;
});

// LOGIKA DLA WZORU DOLNEGO
const mainPatternSvg = computed(() => {
  const selectedId = props.config.patterns.bottom;
  if (!selectedId || selectedId === 'none') return null;

  const patternObj = props.patternsDict.find(p => p.id === selectedId);
  return patternObj ? patternObj.kodSvg : null;
});
</script>

<style scoped>
.fls-2 {
  clip-path: url(#clippath2);
}

.prostokat {
  clip-path: url(#prostokat);
}

.pasek {
  fill: var(--kolor-pasek);
}

.cls-2 {
  fill: none;
}

.cls-4 {
  clip-path: url(#clippath2);
}
</style>
<template>
    <div class="wrapper">
      <h3>Naprawiony Efekt (Dopasowany do szerokości 1100px)</h3>
      
      <svg ref="svgRef" xmlns="http://www.w3.org/2000/svg" fill="#0000ff" viewBox="20 -100 1100 600" style="overflow: visible; border: 1px dashed red; width: 100%; max-width: 800px;">
        
        <g id="target-graphic">
          <g>
            <polygon points="14.2 11.53 28.4 23.75 0 23.75 14.2 11.53"/>
            <polygon points="42.82 11.53 57.02 23.75 28.62 23.75 42.82 11.53"/>
            <polygon points="71.24 11.53 85.44 23.75 57.04 23.75 71.24 11.53"/>
            <polygon points="99.58 11.53 113.78 23.75 85.38 23.75 99.58 11.53"/>
            <polygon points="127.42 11.53 141.62 23.75 113.22 23.75 127.42 11.53"/>
            <polygon points="154.67 11.53 168.87 23.75 140.47 23.75 154.67 11.53"/>
            <polygon points="183.29 11.53 197.49 23.75 169.09 23.75 183.29 11.53"/>
            <polygon points="211.71 11.53 225.91 23.75 197.51 23.75 211.71 11.53"/>
            <polygon points="240.05 11.53 254.25 23.75 225.85 23.75 240.05 11.53"/>
            <polygon points="267.89 11.53 282.09 23.75 253.69 23.75 267.89 11.53"/>
            <polygon points="296.3 11.53 310.5 23.75 282.09 23.75 296.3 11.53"/>
            <polygon points="324.92 11.53 339.12 23.75 310.72 23.75 324.92 11.53"/>
            <polygon points="353.33 11.53 367.53 23.75 339.13 23.75 353.33 11.53"/>
            <polygon points="381.68 11.53 395.88 23.75 367.47 23.75 381.68 11.53"/>
            <polygon points="409.52 11.53 423.72 23.75 395.32 23.75 409.52 11.53"/>
            <polygon points="436.77 11.53 450.97 23.75 422.56 23.75 436.77 11.53"/>
            <polygon points="465.39 11.53 479.59 23.75 451.19 23.75 465.39 11.53"/>
            <polygon points="493.8 11.53 508 23.75 479.6 23.75 493.8 11.53"/>
            <polygon points="522.15 11.53 536.35 23.75 507.94 23.75 522.15 11.53"/>
            <polygon points="549.99 11.53 564.19 23.75 535.79 23.75 549.99 11.53"/>
            <polygon points="564.4 12.22 550.2 0 578.6 0 564.4 12.22"/>
            <polygon points="535.78 12.22 521.58 0 549.98 0 535.78 12.22"/>
            <polygon points="507.36 12.22 493.16 0 521.56 0 507.36 12.22"/>
            <polygon points="479.02 12.22 464.82 0 493.22 0 479.02 12.22"/>
            <polygon points="451.18 12.22 436.98 0 465.38 0 451.18 12.22"/>
            <polygon points="423.93 12.22 409.73 0 438.13 0 423.93 12.22"/>
            <polygon points="395.31 12.22 381.11 0 409.51 0 395.31 12.22"/>
            <polygon points="366.89 12.22 352.69 0 381.09 0 366.89 12.22"/>
            <polygon points="338.55 12.22 324.35 0 352.75 0 338.55 12.22"/>
            <polygon points="310.71 12.22 296.51 0 324.91 0 310.71 12.22"/>
            <polygon points="282.3 12.22 268.1 0 296.51 0 282.3 12.22"/>
            <polygon points="253.68 12.22 239.48 0 267.88 0 253.68 12.22"/>
            <polygon points="225.27 12.22 211.07 0 239.47 0 225.27 12.22"/>
            <polygon points="196.92 12.22 182.72 0 211.13 0 196.92 12.22"/>
            <polygon points="169.08 12.22 154.88 0 183.28 0 169.08 12.22"/>
            <polygon points="141.83 12.22 127.63 0 156.04 0 141.83 12.22"/>
            <polygon points="113.21 12.22 99.01 0 127.41 0 113.21 12.22"/>
            <polygon points="84.8 12.22 70.6 0 99 0 84.8 12.22"/>
            <polygon points="56.45 12.22 42.25 0 70.66 0 56.45 12.22"/>
            <polygon points="28.61 12.22 14.41 0 42.81 0 28.61 12.22"/>
            <polygon points="578.39 11.53 592.59 23.75 564.19 23.75 578.39 11.53"/>
            <polygon points="607.01 11.53 621.21 23.75 592.81 23.75 607.01 11.53"/>
            <polygon points="635.43 11.53 649.63 23.75 621.23 23.75 635.43 11.53"/>
            <polygon points="663.77 11.53 677.97 23.75 649.57 23.75 663.77 11.53"/>
            <polygon points="691.61 11.53 705.81 23.75 677.41 23.75 691.61 11.53"/>
            <polygon points="718.86 11.53 733.06 23.75 704.66 23.75 718.86 11.53"/>
            <polygon points="747.48 11.53 761.68 23.75 733.28 23.75 747.48 11.53"/>
            <polygon points="775.9 11.53 790.1 23.75 761.7 23.75 775.9 11.53"/>
            <polygon points="804.24 11.53 818.44 23.75 790.04 23.75 804.24 11.53"/>
            <polygon points="832.08 11.53 846.28 23.75 817.88 23.75 832.08 11.53"/>
            <polygon points="860.48 11.53 874.68 23.75 846.28 23.75 860.48 11.53"/>
            <polygon points="889.11 11.53 903.31 23.75 874.9 23.75 889.11 11.53"/>
            <polygon points="917.52 11.53 931.72 23.75 903.32 23.75 917.52 11.53"/>
            <polygon points="945.86 11.53 960.06 23.75 931.66 23.75 945.86 11.53"/>
            <polygon points="973.71 11.53 987.91 23.75 959.5 23.75 973.71 11.53"/>
            <polygon points="1000.95 11.53 1015.15 23.75 986.75 23.75 1000.95 11.53"/>
            <polygon points="1029.58 11.53 1043.78 23.75 1015.37 23.75 1029.58 11.53"/>
            <polygon points="1057.99 11.53 1072.19 23.75 1043.79 23.75 1057.99 11.53"/>
            <polygon points="1086.33 11.53 1100.53 23.75 1072.13 23.75 1086.33 11.53"/>
            <polygon points="1114.18 11.53 1128.38 23.75 1099.97 23.75 1114.18 11.53"/>
            <polygon points="1128.59 12.22 1114.39 0 1142.79 0 1128.59 12.22"/>
            <polygon points="1099.96 12.22 1085.76 0 1114.17 0 1099.96 12.22"/>
            <polygon points="1071.55 12.22 1057.35 0 1085.75 0 1071.55 12.22"/>
            <polygon points="1043.21 12.22 1029.01 0 1057.41 0 1043.21 12.22"/>
            <polygon points="1015.37 12.22 1001.16 0 1029.57 0 1015.37 12.22"/>
            <polygon points="988.12 12.22 973.92 0 1002.32 0 988.12 12.22"/>
            <polygon points="959.49 12.22 945.29 0 973.7 0 959.49 12.22"/>
            <polygon points="931.08 12.22 916.88 0 945.28 0 931.08 12.22"/>
            <polygon points="902.74 12.22 888.54 0 916.94 0 902.74 12.22"/>
            <polygon points="874.89 12.22 860.69 0 889.1 0 874.89 12.22"/>
            <polygon points="846.49 12.22 832.29 0 860.69 0 846.49 12.22"/>
            <polygon points="817.87 12.22 803.67 0 832.07 0 817.87 12.22"/>
            <polygon points="789.45 12.22 775.25 0 803.66 0 789.45 12.22"/>
            <polygon points="761.11 12.22 746.91 0 775.31 0 761.11 12.22"/>
            <polygon points="733.27 12.22 719.07 0 747.47 0 733.27 12.22"/>
            <polygon points="706.02 12.22 691.82 0 720.22 0 706.02 12.22"/>
            <polygon points="677.4 12.22 663.2 0 691.6 0 677.4 12.22"/>
            <polygon points="648.98 12.22 634.78 0 663.19 0 648.98 12.22"/>
            <polygon points="620.64 12.22 606.44 0 634.84 0 620.64 12.22"/>
            <polygon points="592.8 12.22 578.6 0 607 0 592.8 12.22"/>
          </g>
    
          <g>
            <polygon points="14.2 203.72 28.4 215.94 0 215.94 14.2 203.72"/>
            <polygon points="42.82 203.72 57.02 215.94 28.62 215.94 42.82 203.72"/>
            <polygon points="71.24 203.72 85.44 215.94 57.04 215.94 71.24 203.72"/>
            <polygon points="99.58 203.72 113.78 215.94 85.38 215.94 99.58 203.72"/>
            <polygon points="127.42 203.72 141.62 215.94 113.22 215.94 127.42 203.72"/>
            <polygon points="154.67 203.72 168.87 215.94 140.47 215.94 154.67 203.72"/>
            <polygon points="183.29 203.72 197.49 215.94 169.09 215.94 183.29 203.72"/>
            <polygon points="211.71 203.72 225.91 215.94 197.51 215.94 211.71 203.72"/>
            <polygon points="240.05 203.72 254.25 215.94 225.85 215.94 240.05 203.72"/>
            <polygon points="267.89 203.72 282.09 215.94 253.69 215.94 267.89 203.72"/>
            <polygon points="296.3 203.72 310.5 215.94 282.09 215.94 296.3 203.72"/>
            <polygon points="324.92 203.72 339.12 215.94 310.72 215.94 324.92 203.72"/>
            <polygon points="353.33 203.72 367.53 215.94 339.13 215.94 353.33 203.72"/>
            <polygon points="381.68 203.72 395.88 215.94 367.47 215.94 381.68 203.72"/>
            <polygon points="409.52 203.72 423.72 215.94 395.32 215.94 409.52 203.72"/>
            <polygon points="436.77 203.72 450.97 215.94 422.56 215.94 436.77 203.72"/>
            <polygon points="465.39 203.72 479.59 215.94 451.19 215.94 465.39 203.72"/>
            <polygon points="493.8 203.72 508 215.94 479.6 215.94 493.8 203.72"/>
            <polygon points="522.15 203.72 536.35 215.94 507.94 215.94 522.15 203.72"/>
            <polygon points="549.99 203.72 564.19 215.94 535.79 215.94 549.99 203.72"/>
            <polygon points="564.4 204.4 550.2 192.18 578.6 192.18 564.4 204.4"/>
            <polygon points="535.78 204.4 521.58 192.18 549.98 192.18 535.78 204.4"/>
            <polygon points="507.36 204.4 493.16 192.18 521.56 192.18 507.36 204.4"/>
            <polygon points="479.02 204.4 464.82 192.18 493.22 192.18 479.02 204.4"/>
            <polygon points="451.18 204.4 436.98 192.18 465.38 192.18 451.18 204.4"/>
            <polygon points="423.93 204.4 409.73 192.18 438.13 192.18 423.93 204.4"/>
            <polygon points="395.31 204.4 381.11 192.18 409.51 192.18 395.31 204.4"/>
            <polygon points="366.89 204.4 352.69 192.18 381.09 192.18 366.89 204.4"/>
            <polygon points="338.55 204.4 324.35 192.18 352.75 192.18 338.55 204.4"/>
            <polygon points="310.71 204.4 296.51 192.18 324.91 192.18 310.71 204.4"/>
            <polygon points="282.3 204.4 268.1 192.18 296.51 192.18 282.3 204.4"/>
            <polygon points="253.68 204.4 239.48 192.18 267.88 192.18 253.68 204.4"/>
            <polygon points="225.27 204.4 211.07 192.18 239.47 192.18 225.27 204.4"/>
            <polygon points="196.92 204.4 182.72 192.18 211.13 192.18 196.92 204.4"/>
            <polygon points="169.08 204.4 154.88 192.18 183.28 192.18 169.08 204.4"/>
            <polygon points="141.83 204.4 127.63 192.18 156.04 192.18 141.83 204.4"/>
            <polygon points="113.21 204.4 99.01 192.18 127.41 192.18 113.21 204.4"/>
            <polygon points="84.8 204.4 70.6 192.18 99 192.18 84.8 204.4"/>
            <polygon points="56.45 204.4 42.25 192.18 70.66 192.18 56.45 204.4"/>
            <polygon points="28.61 204.4 14.41 192.18 42.81 192.18 28.61 204.4"/>
            <polygon points="578.39 203.72 592.59 215.94 564.19 215.94 578.39 203.72"/>
            <polygon points="607.01 203.72 621.21 215.94 592.81 215.94 607.01 203.72"/>
            <polygon points="635.43 203.72 649.63 215.94 621.23 215.94 635.43 203.72"/>
            <polygon points="663.77 203.72 677.97 215.94 649.57 215.94 663.77 203.72"/>
            <polygon points="691.61 203.72 705.81 215.94 677.41 215.94 691.61 203.72"/>
            <polygon points="718.86 203.72 733.06 215.94 704.66 215.94 718.86 203.72"/>
            <polygon points="747.48 203.72 761.68 215.94 733.28 215.94 747.48 203.72"/>
            <polygon points="775.9 203.72 790.1 215.94 761.7 215.94 775.9 203.72"/>
            <polygon points="804.24 203.72 818.44 215.94 790.04 215.94 804.24 203.72"/>
            <polygon points="832.08 203.72 846.28 215.94 817.88 215.94 832.08 203.72"/>
            <polygon points="860.48 203.72 874.68 215.94 846.28 215.94 860.48 203.72"/>
            <polygon points="889.11 203.72 903.31 215.94 874.9 215.94 889.11 203.72"/>
            <polygon points="917.52 203.72 931.72 215.94 903.32 215.94 917.52 203.72"/>
            <polygon points="945.86 203.72 960.06 215.94 931.66 215.94 945.86 203.72"/>
            <polygon points="973.71 203.72 987.91 215.94 959.5 215.94 973.71 203.72"/>
            <polygon points="1000.95 203.72 1015.15 215.94 986.75 215.94 1000.95 203.72"/>
            <polygon points="1029.58 203.72 1043.78 215.94 1015.37 215.94 1029.58 203.72"/>
            <polygon points="1057.99 203.72 1072.19 215.94 1043.79 215.94 1057.99 203.72"/>
            <polygon points="1086.33 203.72 1100.53 215.94 1072.13 215.94 1086.33 203.72"/>
            <polygon points="1114.18 203.72 1128.38 215.94 1099.97 215.94 1114.18 203.72"/>
            <polygon points="1128.59 204.4 1114.39 192.18 1142.79 192.18 1128.59 204.4"/>
            <polygon points="1099.96 204.4 1085.76 192.18 1114.17 192.18 1099.96 204.4"/>
            <polygon points="1071.55 204.4 1057.35 192.18 1085.75 192.18 1071.55 204.4"/>
            <polygon points="1043.21 204.4 1029.01 192.18 1057.41 192.18 1043.21 204.4"/>
            <polygon points="1015.37 204.4 1001.16 192.18 1029.57 192.18 1015.37 204.4"/>
            <polygon points="988.12 204.4 973.92 192.18 1002.32 192.18 988.12 204.4"/>
            <polygon points="959.49 204.4 945.29 192.18 973.7 192.18 959.49 204.4"/>
            <polygon points="931.08 204.4 916.88 192.18 945.28 192.18 931.08 204.4"/>
            <polygon points="902.74 204.4 888.54 192.18 916.94 192.18 902.74 204.4"/>
            <polygon points="874.89 204.4 860.69 192.18 889.1 192.18 874.89 204.4"/>
            <polygon points="846.49 204.4 832.29 192.18 860.69 192.18 846.49 204.4"/>
            <polygon points="817.87 204.4 803.67 192.18 832.07 192.18 817.87 204.4"/>
            <polygon points="789.45 204.4 775.25 192.18 803.66 192.18 789.45 204.4"/>
            <polygon points="761.11 204.4 746.91 192.18 775.31 192.18 761.11 204.4"/>
            <polygon points="733.27 204.4 719.07 192.18 747.47 192.18 733.27 204.4"/>
            <polygon points="706.02 204.4 691.82 192.18 720.22 192.18 706.02 204.4"/>
            <polygon points="677.4 204.4 663.2 192.18 691.6 192.18 677.4 204.4"/>
            <polygon points="648.98 204.4 634.78 192.18 663.19 192.18 648.98 204.4"/>
            <polygon points="620.64 204.4 606.44 192.18 634.84 192.18 620.64 204.4"/>
            <polygon points="592.8 204.4 578.6 192.18 607 192.18 592.8 204.4"/>
          </g>
        </g> </svg>
    
      <div class="controls">
        <button @click="bendIt">Wygnij to!</button>
        <button @click="reset">Reset</button>
      </div>
    </div>
    </template>
    
    <script setup>
    import { ref, onMounted } from 'vue';
    import Warp from 'warpjs';
    
    const svgRef = ref(null);
    let warpInstance = null;
    
    const initWarp = () => {
  if (!svgRef.value) return;
  
  const elementToBend = svgRef.value.querySelector('#target-graphic');
  
  // --- FIX START: Konwersja Polygon na Path ---
  // Szukamy wszystkich polygonów wewnątrz naszej grupy
  const polygons = elementToBend.querySelectorAll('polygon');
  
  polygons.forEach(poly => {
  const pointsStr = poly.getAttribute('points');
  if (!pointsStr) return;

  // 1. Rozbijamy string na tablicę samych liczb (ignorujemy spacje i przecinki)
  const coords = pointsStr.trim().split(/[\s,]+/);

  // 2. Budujemy string 'd' biorąc liczby PARAMI
  let d = "";
  for (let i = 0; i < coords.length; i += 2) {
    const x = coords[i];
    const y = coords[i + 1];

    // Jeśli z jakiegoś powodu brakuje drugiej współrzędnej, przerywamy
    if (y === undefined) break;

    if (i === 0) {
      // Pierwsza para to M (Move to)
      d += `M ${x} ${y}`;
    } else {
      // Kolejne pary to L (Line to)
      d += ` L ${x} ${y}`;
    }
  }
  
  // Zamykamy kształt
  d += " Z";

  // 3. Tworzymy path
  const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
  path.setAttribute('d', d);
  
  // Ważne: Kopiujemy style/klasy/id, żeby "pattern" (wygląd) nie zginął
  // Jeśli polygon miał klasę css, przenosimy ją
  if (poly.getAttribute('class')) path.setAttribute('class', poly.getAttribute('class'));
  // Jeśli miał styl inline
  if (poly.getAttribute('style')) path.setAttribute('style', poly.getAttribute('style'));
  // Jeśli miał fill bezpośrednio
  if (poly.getAttribute('fill')) path.setAttribute('fill', poly.getAttribute('fill'));

  // Podmieniamy
  poly.parentNode.replaceChild(path, poly);
});
  // --- FIX END ---

  // Teraz Warp dostaje same czyste <path>, na których umie pracować
  warpInstance = new Warp(elementToBend);
  warpInstance.interpolate(4);
};
    
    const bendIt = () => {
    if (!warpInstance) initWarp();
    
    warpInstance.transform(([x, y]) => {
      // ZMIANA 2: Środek grafiki o szerokości 1100 to ok. 550
      const centerX = 550; 
      
      const dist = x - centerX;
      
      // ZMIANA 3: Dużo mniejszy mnożnik, bo dist^2 jest tu ogromne (np. 550*550 = 302500)
      // 300000 * 0.0002 = 60px wygięcia (rozsądnie)
      const bendOffset = 0.0002 * Math.pow(dist, 2);
      
      return [x, y + bendOffset];
    });
    };
    
    const reset = () => {
    location.reload(); 
    };
    </script>
    
    <style scoped>
    .wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    margin-top: 50px;
    width: 100%;
    }
    button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    }
    </style>